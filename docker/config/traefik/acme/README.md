# ACME Certificates Directory

This directory stores TLS/SSL certificates obtained from Let's Encrypt via Traefik's ACME integration.

## Files

- **acme.json** - Let's Encrypt production certificates storage (auto-generated by Traefik)
- **acme-staging.json** - Let's Encrypt staging certificates for testing (auto-generated by Traefik)
- **cert.pem** - Development certificate (generated by mkcert)
- **key.pem** - Development private key (generated by mkcert)

## Security

### Production (acme.json)
The `acme.json` file contains sensitive private keys and MUST have restricted permissions:

```bash
chmod 600 acme.json
```

Traefik will refuse to start if this file has incorrect permissions.

### Development (cert.pem/key.pem)
Development certificates are generated by `scripts/setup-dev-certs.sh` using mkcert.
These certificates are only trusted on your local machine.

## Usage

### Production Mode
1. Traefik automatically requests certificates from Let's Encrypt
2. Certificates are stored in `acme.json`
3. Traefik handles renewals automatically (30 days before expiry)

### Development Mode
1. Run `scripts/setup-dev-certs.sh` to generate local certificates
2. Certificates are stored in `cert.pem` and `key.pem`
3. Traefik uses these via `dynamic/dev-certs.yml` configuration

## Let's Encrypt Rate Limits

Be aware of Let's Encrypt rate limits:
- 50 certificates per registered domain per week
- 5 duplicate certificates per week
- 300 new orders per account per 3 hours

Use staging environment for testing to avoid hitting limits.

## Certificate Lifecycle

1. **Obtain**: Traefik requests certificate when new route is added
2. **Store**: Certificate saved to acme.json with 600 permissions
3. **Renew**: Automatic renewal 30 days before expiry
4. **Serve**: Traefik serves HTTPS traffic using certificates

## Troubleshooting

### Certificate not obtained
- Check Traefik logs: `docker logs erp-saas-cloud-c16-traefik`
- Verify DNS points to your server
- Check firewall allows ports 80/443
- Verify email in traefik.yml is valid

### Permission denied errors
- Ensure acme.json has 600 permissions
- Ensure acme directory is readable by Traefik container

### Rate limit exceeded
- Switch to staging environment temporarily
- Wait for rate limit window to reset
- Consider using wildcard certificates

## Development vs Production

| Feature | Development | Production |
|---------|-------------|------------|
| Certificate Authority | mkcert (local CA) | Let's Encrypt |
| Files | cert.pem, key.pem | acme.json |
| Trust | Local machine only | Globally trusted |
| Renewal | Manual | Automatic |
| Rate Limits | None | Yes |

## References

- [Traefik ACME Documentation](https://doc.traefik.io/traefik/https/acme/)
- [Let's Encrypt Rate Limits](https://letsencrypt.org/docs/rate-limits/)
- [mkcert Documentation](https://github.com/FiloSottile/mkcert)
